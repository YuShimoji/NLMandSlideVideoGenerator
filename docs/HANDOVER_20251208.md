# 📋 作業申し送り - 2025-12-08

## ✅ 今回完了したタスク・決定事項

- Y 系タスクの整理・進捗
  - `Y1-softalk-eval-doc`: SofTalk/AquesTalk ローカルTTS連携の評価結果をドキュメントに反映
    - `docs/tts_batch_softalk_aquestalk.md` に「環境依存が大きいため任意の上級者向けオプション」という位置づけを明記
    - `docs/user_guide_manual_workflow.md` に、YMM4/他TTSと並列のオプションとして記載
  - `Y2-ymm4-arch`: YMM4 中心の最終フローアーキテクチャ設計
    - 新規ドキュメント `docs/ymm4_integration_arch.md` を作成
    - CSVタイムラインモードと YMM4 の責務分担、Y3〜Y5/C2/C3 系タスクとの対応関係を整理
  - `Y6-ymm4-doc-sync`: backlog / ユーザーガイド / TTS仕様 の同期
    - `docs/backlog.md` の補足方針に YMM4 中心フローと Softalk/AquesTalk の位置づけを明記

- ドキュメント横断の整合性調整（H1-doc-sync-final）
  - `docs/development_guide.md`
    - 手動E2Eワークフローの節で、
      - 「CSV + SofTalk/AquesTalk TTS Webフロー」は **環境が合う場合のオプション** であることを明記
      - YMM4 や他TTSで生成した WAV でも同じ CSV タイムラインパイプラインが使えることを明示
  - `docs/spec_csv_input_format.md`
    - 関連ドキュメントに `docs/ymm4_integration_arch.md` を追加（CSV仕様から YMM4 アーキ設計への導線を確保）
  - `docs/ymm4_export_spec.md`
    - 関連ドキュメントに `docs/ymm4_integration_arch.md` を追加（YMM4エクスポート詳細仕様と全体アーキの橋渡し）
  - `docs/project_completion_report.md`
    - プロジェクト概要に注記を追加:
      - 本レポートが「2024-12 完成レポート + 2025-11 以降の追記」を含む **時系列スナップショット** であること
      - 最新の残タスク・YMM4中心方針・Softalk/AquesTalkの最終的な位置づけは `docs/backlog.md` / `docs/ymm4_integration_arch.md` を一次情報源とすることを明示

- 新規アーキテクチャドキュメント
  - `docs/ymm4_integration_arch.md`
    - 目的: 「YMM4 を中心に据えた最終フロー」の設計レベル SSOT
    - 主なポイント:
      - CSV タイムラインモードの前提は「`csv` + 行ごと `wav`（001.wav, 002.wav, ...）」のみ
      - Softalk/AquesTalk は環境依存の大きいオプションであり、主フローではない
      - 2つのパターンを定義
        - パターンA: **YMM4 で音声(WAV)生成 → 本アプリで動画/字幕/サムネ/メタデータ生成**
        - パターンB: **本アプリで YMM4 プロジェクトを出力 → YMM4 側で仕上げ**
      - フェーズ別ロードマップ
        - Y2: 本ドキュメント（アーキ設計）
        - Y3: YMM4 自動化 PoC シナリオの具体化（AutoHotkey 前提）
        - Y4: PoC 実装（YMM4 起動〜音声一括生成〜WAV書き出しまでの半自動化）
        - Y5: YMM4 出力WAV → `audio_dir` の `001.wav` 形式に整形するブリッジ設計・実装
      - 既存コードへのフックポイント
        - `scripts/run_csv_pipeline.py` / `src/core/pipeline.py::run_csv_timeline()` は「YMM4で用意された WAV を入力として受けるだけ」で、YMM4自体を直接操作しない方針
        - 将来 `scripts/ymm4_audio_bridge.py`（仮）で YMM4 の書き出し結果と `audio_dir` を橋渡しする案を明示

## 📊 現在の方針と位置づけ

- CSV タイムラインモードの SSOT
  - 仕様: `docs/spec_csv_input_format.md`
  - 動作: `scripts/run_csv_pipeline.py` / `src/core/pipeline.py::run_csv_timeline()`
- YMM4 連携の SSOT
  - アーキ設計: `docs/ymm4_integration_arch.md`
  - エクスポート仕様: `docs/ymm4_export_spec.md`
- Softalk/AquesTalk の位置づけ
  - 仕様: `docs/tts_batch_softalk_aquestalk.md`
  - 方針: **「ローカル環境が適合している場合に利用可能な上級者オプション」**
  - メインフローは「任意の手段で 001.wav, 002.wav, ... を用意したうえで CSV タイムラインパイプラインを実行する」ことに一本化

## 🧪 テスト・確認状況（2025-12-08 時点）

- テスト
  - 実行コマンド: `python -m pytest tests/ -v --tb=short`
  - 結果: **100 passed, 7 skipped**（統合テスト含む。スキップは想定どおりで、APIや設定未投入の統合テストに起因）
- Web UI / CSV パイプライン
  - 既存の CSV+WAV フローは `docs/user_guide_manual_workflow.md` に沿って利用可能
  - CSV + SofTalk/AquesTalk TTS Webフロー E2E 手順は「動作すれば便利なオプション」として維持

## 🔄 次回以降の推奨作業

- Y3-ymm4-poc-plan
  - `docs/ymm4_integration_arch.md` §5.2 をベースに、具体的な PoC シナリオと前提条件を短い設計メモとして切り出す
  - 想定アウトプット: `docs/ymm4_poc_plan.md`（仮称）
- Y4-ymm4-poc-impl
  - AutoHotkey 等を用いた最小限の自動フロー実装（YMM4起動〜音声一括生成〜WAV書き出し）
  - 当面は「本アプリからは直接呼び出さない」「ユーザー手動実行」を前提とした PoC で問題なし
- Y5-ymm4-bridge
  - YMM4 が書き出した WAV を `audio_dir` の `001.wav` 命名にマッピングするブリッジ CLI の設計・実装

## 📁 今回主に変更したファイル

- `docs/tts_batch_softalk_aquestalk.md`  ※前回セッションまでに更新済み
- `docs/user_guide_manual_workflow.md`   ※前回セッションまでに更新済み
- `docs/backlog.md`
- `docs/development_guide.md`
- `docs/spec_csv_input_format.md`
- `docs/ymm4_export_spec.md`
- `docs/ymm4_integration_arch.md`（新規作成）
- `scripts/tts_batch_softalk_aquestalk.py`  ※SofTalkコマンドライン引数修正（/R と /W の整理）

## 🔧 開発環境メモ

- リポジトリルート: `c:/Users/thank/Storage/Media Contents Projects/NLMandSlideVideoGenerator`
- Web UI 起動例:
  - `python run_web_app.py`
  - または `streamlit run src/web/web_app.py --server.port 8502`
- テスト実行例:
  - `python -m pytest tests/ -v --tb=short`

---

**作業者**: AI Assistant  
**日時**: 2025-12-08  
**ステータス**: ドキュメント同期完了 / コード変更は次フェーズ（Y3〜Y5）で実施予定
