# 作業申し送り (2025-12-10)

## 1. 本セッションで実施した作業

### 1.1 YMM4 プラグイン API 調査と方針変更

- **YMM4 API の性質を確認**: REST HTTP API ではなく、**.NET プラグインシステム**であることを確認
- **方針変更**: AutoHotkey から **プラグイン API 優先** に変更
  - AutoHotkey は代替手段として位置づけ

### 1.2 C# プラグインプロジェクトの作成

新規ディレクトリ `ymm4-plugin/` に以下を作成:

| ファイル | 内容 |
|---------|------|
| `NLMSlidePlugin.csproj` | .NET 9 プラグインプロジェクト定義 |
| `Directory.Build.props.sample` | YMM4 パス設定テンプレート |
| `PluginInfo.cs` | `IPlugin` 実装（プラグインメタデータ） |
| `VoicePlugin/CsvTimelineVoicePlugin.cs` | `IVoicePlugin` スケルトン |
| `TextCompletionPlugin/CsvScriptCompletionPlugin.cs` | `ITextCompletionPlugin` スケルトン |
| `README.md` | セットアップ手順・構成説明 |

**注意**: lint エラー（YukkuriMovieMaker 参照不足）は、`Directory.Build.props` で YMM4 パスを設定することで解決します。

### 1.3 ドキュメント更新

| ドキュメント | 変更内容 |
|-------------|---------|
| `docs/ymm4_poc_plan.md` | プラグイン API 優先アプローチに更新、シナリオ Zero 追加 |
| `docs/ymm4_integration_arch.md` | プラグイン優先・AutoHotkey 代替の方針を反映 |

## 2. 次回推奨作業

### 2.1 シナリオ Zero: プラグイン動作確認（最優先）

1. **環境準備**:
   - .NET 9 SDK インストール
   - YMM4 v4.33.0.0 以降インストール

2. **プラグインセットアップ**:
   ```powershell
   cd ymm4-plugin
   cp Directory.Build.props.sample Directory.Build.props
   # Directory.Build.props を編集して YMM4DirPath を設定
   dotnet build
   ```

3. **動作確認**:
   - YMM4 起動
   - `設定` → `プラグイン` → `プラグイン一覧` で「NLM Slide Plugin」を確認

### 2.2 シナリオ A: プラグイン機能実装

シナリオ Zero 完了後:
- `ITextCompletionPlugin` で CSV テキストインポート機能を実装
- YMM4 タイムラインへのアイテム追加検証

### 2.3 代替手段（必要時のみ）

プラグイン API で実現困難な操作がある場合:
- AutoHotkey による GUI 自動化を検討

## 3. 現在のタスクステータス

| タスク ID | 内容 | ステータス |
|----------|------|-----------|
| Y3-ymm4-poc-plan | YMM4 自動化 PoC 計画 | ✅ 完了（API 優先に更新） |
| Y3a-ymm4-api-investigation | YMM4 プラグイン API 調査 | ✅ 完了 |
| Y4-ymm4-poc-impl | YMM4 自動化 PoC 実装 | 🚧 次回作業 |
| Y5-ymm4-bridge | YMM4 出力音声とパイプラインの橋渡し | ⏳ 保留 |

## 4. 主要な変更ファイル一覧

### 新規作成
- `ymm4-plugin/NLMSlidePlugin.csproj`
- `ymm4-plugin/Directory.Build.props.sample`
- `ymm4-plugin/PluginInfo.cs`
- `ymm4-plugin/VoicePlugin/CsvTimelineVoicePlugin.cs`
- `ymm4-plugin/TextCompletionPlugin/CsvScriptCompletionPlugin.cs`
- `ymm4-plugin/README.md`
- `docs/HANDOVER_20251210.md`

### 更新
- `docs/ymm4_poc_plan.md`
- `docs/ymm4_integration_arch.md`

## 5. 参考リンク

- [YMM4 API Docs](https://ymm-api-docs.vercel.app/)
- [YMM4 Plugin Samples](https://github.com/manju-summoner/YukkuriMovieMaker4PluginSamples)

## 6. 技術的メモ

### YMM4 プラグイン開発の要点

1. **.NET 9 SDK 必須**
2. **YMM4 アセンブリ参照**:
   - `YukkuriMovieMaker.Plugin.dll`
   - `YukkuriMovieMaker.Commons.dll`
3. **ビルド後自動コピー**: `$(YMM4DirPath)user\plugin\` へ
4. **開発者モード**: `設定` → `開発者モード` で有効化可能
5. **プラグインパッケージ**: zip 圧縮 → `.ymme` に拡張子変更で配布可能

### 利用可能なプラグインインターフェース

| インターフェース | 用途 |
|-----------------|------|
| `IPlugin` | 基本プラグイン情報 |
| `IVoicePlugin` | ボイス生成 |
| `ITextCompletionPlugin` | テキスト補完・LLM 連携 |
| `IAudioFileSourcePlugin` | 外部音声ファイルソース |
| `IVideoFileSourcePlugin` | 外部動画ファイルソース |
| `ITachiePlugin` | 立ち絵 |
| `IShapePlugin` | 図形 |
